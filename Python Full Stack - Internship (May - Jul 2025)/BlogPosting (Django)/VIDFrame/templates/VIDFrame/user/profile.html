{% extends 'VIDFrame/layouts/main.html' %}

{% block title %}
VIDFRame | Profile Page
{% endblock title %}

{% block content %}
    <section class="container-fluid py-5 my-2">
        <div class="row">
            <div class="col-12">
                {% include 'VIDFrame/inc/message.html' %}
            </div>
        </div>
        <div class="row px-5">
            <div class="col-5 profile">
                <div class="row profile_pic">
                    {% if profile.profile_pic %}
                        <img src="{{ profile.profile_pic.url }}" style="width:100%; height:100%;" alt="Profile">
                    {% else %}
                        Profile Pic
                    {% endif %}
                </div>
                <div class="row profile_fields">
                    <h2>@ {{ profile.user.username }}</h2>
                    <ul class="list-group list-group-horizontal">
                        <li class="list-group-item"><a href="{% url 'userReels' userName=request.user.username %}"><i class="fa fa-video-camera" aria-hidden="true"></i></a></li>
                        <li class="list-group-item"><a href="{% url 'userImages' userName=request.user.username %}"><i class="fa fa-picture-o" aria-hidden="true"></i></a></li>
                    </ul>
                </div>
            </div>
            <div class="col-7">
                <form action="" method="post" id="profile_form">
                    {% csrf_token %}
                    <div class="row">
                        <table class="table table-borderless">
                            <thead>
                                <tr>
                                    <th colspan="4">
                                        <span class="display-6 fw-bold">Profile Details</span> 
                                        <a href="{% url 'profile' %}" class="text-decoration-none px-2"><i class="fa fa-rotate-right fs-2 text-secondary" title="Reload"></i></a>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="4">
                                        <div class="input-group mb-3">
                                            <label for="username" class="input-group-text"> User Name </label>
                                            <input type="text" id="username" class="form-control" name="username" value="{{ profile.user.username }}" disabled>
                                            <span class="input-group-text"><i class="fa fa-pencil"></i></span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <div class="input-group mb-3">
                                            <label for="first_name" class="input-group-text"> First Name </label>
                                            <input type="text" id="first_name" class="form-control" name="first_name" value="{{ profile.user.first_name }}" disabled>
                                            <span class="input-group-text"><i class="fa fa-pencil"></i></span>
                                        </div>
                                    </td>
                                    <td colspan="2">
                                        <div class="input-group mb-3">
                                            <label for="last_name" class="input-group-text"> Last Name </label>
                                            <input type="text" id="last_name" class="form-control" name="last_name" value="{{ profile.user.last_name }}" disabled>
                                            <span class="input-group-text"><i class="fa fa-pencil"></i></span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <div class="input-group mb-3">
                                            <label for="email" class="input-group-text"> Email </label>
                                            <input type="email" id="email" class="form-control" name="email" value="{{ profile.user.email }}" disabled>
                                            <span class="input-group-text"><i class="fa fa-pencil"></i></span>
                                        </div>
                                    </td>
                                    <td colspan="2">
                                        <div class="input-group mb-3">
                                            <label for="contact" class="input-group-text"> Contact </label>
                                            <input type="text" class="form-control" id="contact" name="contact" value="{{ profile.contact }}" disabled>
                                            <span class="input-group-text"><i class="fa fa-pencil"></i></span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4">
                                        <div class="input-group mb-3">
                                            <label for="old_pwd" class="input-group-text"> Change Password </label>
                                            <input type="password" id="old_pwd" class="form-control" name="old_pwd" placeholder="Old Password">
                                            <span class="input-group-text"><i class="fa fa-eye-slash"></i></span>
                                            <input type="password" id="new_pwd1" class="form-control" name="new_pwd1" placeholder="New Password">
                                            <span class="input-group-text"><i class="fa fa-eye-slash"></i></span>
                                            <input type="password" id="new_pwd2" class="form-control" name="new_pwd2" placeholder="Re-Enter New Password">
                                            <span class="input-group-text"><i class="fa fa-eye-slash"></i></span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4">
                                        <div class="input-group mb-3">
                                            <label for="uploadBtn" class="input-group-text"> Profile Pic </label>
                                            <input type="text" class="form-control" value="{% if profile.profile_pic %} {{profile.profile_pic.url}} {% endif %}" disabled>
                                            <input type="file" class="form-control" id="profile_pic" accept="image/*" name="profile_pic">
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="4" class="text-center">
                                        <button type="submit" class="btn btn-primary" id="submitBtn"> Save Changes </button>
                                        <button type="reset" class="btn btn-primary"> Reset </button>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </form>
            </div>
        </div>
    </section>
{% endblock content %}

{% block script %}
    <script>
        $(document).ready(function(event){
            const usernameEle = $('#username');
            const firstnameEle = $('#first_name');
            const lastnameEle = $('#last_name');
            const emailEle = $('#email');
            const contactEle = $('#contact');
            const old_pwdEle = $('#old_pwd');
            const new_pwd1Ele = $('#new_pwd1');
            const new_pwd2Ele = $('#new_pwd2');
            const profile_picEle = $('#profile_pic');

            const oldPwd_Icon = $(old_pwdEle).next('span').children('i')
            const newPwd1_Icon = $(new_pwd1Ele).next('span').children('i')
            const newPwd2_Icon = $(new_pwd2Ele).next('span').children('i')

            toggleEdit($(usernameEle), $(firstnameEle), $(lastnameEle), $(emailEle), $(contactEle));
            toggleEye(old_pwdEle, oldPwd_Icon)
            toggleEye(new_pwd1Ele, newPwd1_Icon)
            toggleEye(new_pwd2Ele, newPwd2_Icon)
            
            const profileForm = $('#profile_form')
            profileFormValidation($(profileForm),$(old_pwdEle),$(new_pwd1Ele),$(new_pwd2Ele));       
        });
    </script>
{% endblock script %}